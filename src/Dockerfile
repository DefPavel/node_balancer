# Указываем базовый образ Node.js
FROM node:20.11.0-alpine3.18

# Устанавливаем рабочую директорию внутри контейнера
WORKDIR /usr/src/app

# Копируем package.json и package-lock.json
COPY package*.json ./

# Устанавливаем зависимости
RUN npm install -g pm2 && npm install

# Копируем остальную часть кода приложения
COPY . .

# Указываем команду для запуска приложения с помощью PM2
# - i max говорит PM2 запустить максимальное количество процессов, соответствующее количеству ядер процессора
CMD ["pm2-runtime", "start", "app.js", "-i", "max"]

# Экспонируем порт приложения (если необходимо)
EXPOSE 3000
